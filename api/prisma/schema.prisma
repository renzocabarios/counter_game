// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User {
  address    String     @id
  username  String @unique
  referralCode  String @unique
  profilePic  String 
  deposit Int @default(0)
  numberOfReferrals Int @default(0)

  referredBy   User?   @relation(name: "UserReferrals", fields: [referredById], references: [address])
  referredById String? @unique
  referredUser User?   @relation(name: "UserReferrals")


  referralsGiven Referral[] @relation(name: "ReferrerRelation")
  referralsReceived Referral[] @relation(name: "ReferredRelation")
}


model Referral {
  id          Int     @id @default(autoincrement())
  referrer    User    @relation(name: "ReferrerRelation", fields: [referrerId], references: [address])
  referrerId  String
  referred    User    @relation(name: "ReferredRelation", fields: [referredId], references: [address])
  referredId  String
}

enum GameStatus {
  PENDING
  WON
  LOSE
}

model CoinFlipSession {
  id    Int       @id @default(autoincrement())
  status  GameStatus   @default(PENDING)
  address  String
  bet  Int
  flips CoinFlip[]
}

enum CoinFlipType {
  HEADS
  TAILS
}

enum CoinFlipStatus {
  WON
  LOSE
}


model CoinFlip {
  id    Int       @id @default(autoincrement())
  userGuess CoinFlipType
  houseAnswer CoinFlipType
  status CoinFlipStatus
  coinFlipSession    CoinFlipSession    @relation(fields: [coinFlipSessionId], references: [id])
  coinFlipSessionId  Int
}


model DiceGameSession {
  id    Int       @id @default(autoincrement())
  status  GameStatus   @default(PENDING)
  flips DiceGameFlip[]

}

enum DiceGameFlipType {
  OVER
  UNDER
}

enum DiceGameFlipStatus {
  OVER
  UNDER
}

model DiceGameFlip {
  id    Int       @id @default(autoincrement())
  flipType DiceGameFlipType
  userGuess Int
  houseInput Int
  status DiceGameFlipStatus
  diceFlipSession    DiceGameSession    @relation(fields: [diceFlipSessionId], references: [id])
  diceFlipSessionId  Int
}


model LuckyNumberSession {
  id    Int       @id @default(autoincrement())
  status  GameStatus   @default(PENDING)
  draws LuckyNumberDraw[]
}

model LuckyNumberDraw {
  id    Int       @id @default(autoincrement())
  userGuess Int
  houseInput Int
  luckyNumberSession    LuckyNumberSession    @relation(fields: [luckyNumberSessionId], references: [id])
  luckyNumberSessionId  Int
}